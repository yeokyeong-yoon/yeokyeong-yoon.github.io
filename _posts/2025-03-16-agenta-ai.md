---
layout: post
title: "프롬프트 엔지니어링 플랫폼 구축기: Agenta AI 오픈소스 기여 경험"
date: 2025-03-16
categories: [개발, 오픈소스, LLM]
tags: [프롬프트 엔지니어링, Agenta AI, 오픈소스, LLM, FastAPI]
---
2023년 하반기에 3개월 정도 LLM 프로젝트 TF에서 짧게 일을 했다. 그때 맡은 업무가 프롬프트 엔지니어링 플랫폼을 만드는 것이었다. 그동안 LLM 서비스를 요긴하게 쓰기만 했지, 프롬프트가 왜 중요한지 깊이 이해하지 못했다. 솔직히 말하면 "프롬프트 엔지니어링"이라는 분야에 대해 처음에는 그 중요성과 깊이를 제대로 인식하지 못했다. 단순히 텍스트를 입력하는 작업이라고 생각했던 것이 사실이다. 이렇게 분야에 대한 이해가 부족했던 내가 어떻게 이 프로젝트에 참여하게 되었는지, 프롬프트 엔지니어링 플랫폼을 만들다가 어떻게 Agenta AI라는 오픈소스 프로젝트에 기여하게 되었는지, 그리고 이 과정에서 무엇을 배웠는지 나눠보려고 한다.

## 프롬프트 관리의 어려움과 도전

당시 TF를 만들었던 팀은 리뷰 요약 서비스를 개발하면서 LLM을 활용한 프롬프트 개발에 많은 시간을 쏟았다. 하지만 여러 어려움에 부딪혔다. 프롬프트 버전 관리는 파일명에 v1, v2만 붙이는 수준이었고, 여러 프롬프트 성능을 비교하려면 수작업으로 테스트해야 했다. 특히 팀원 간 좋은 프롬프트를 공유하는 체계적인 방법이 없어서 스크린샷, 화면 공유 혹은 csv파일로 변경 등 수동적으로 해결해야 하는 업무가 있었다. 또한 프롬프트 변경 시 정말 개선되었는지, 기대한 만큼의 효과가 있는지 판단할 객관적인 기준도 부재했다.

LLM 프로젝트 경험이 없었지만, 문제점을 파악하기 위해 나도 간단하게 OpenAI API를 통해서 대화 데이터를 여러개 뽑아보았다. 평소에는 아무 생각 없이 ChatGPT 같은 LLM의 답변에 감사하며 사용했지만, 업무에 필요한 데이터를 추출하려고 하니 상황이 달랐다. LLM이 instruction을 잘 따르지 않거나, instruction을 잘 따르면 내용이 별로거나, 내용이 괜찮으면 포맷이 잘못되는 등의 문제가 발생했다. 완벽한 답변을 얻기 위해 여러번 프롬프트를 수정하고 제공해야 했는데, 마치 두더지 잡기 같은 느낌이 들었다.

이런 문제들로 인해 효율적인 프롬프트 개발이 어려웠고, "프롬프트 엔지니어링 플랫폼"의 필요성을 절감하게 되었다. 우리에게는 프롬프트를 체계적으로 저장하고 버전 관리할 수 있는 시스템, 프롬프트에 다양한 변형을 주고 이를 효과적으로 관리할 수 있는 도구, 프롬프트 성능을 객관적으로 평가할 수 있는 방법, 그리고 팀원들이 결과를 쉽게 공유하고 의견(투표 등)을 교환할 수 있는 협업 기능을 갖춘 통합 플랫폼이 필요했다. 이러한 플랫폼이 있다면 프롬프트 개발 과정의 비효율성을 크게 줄이고 더 나은 품질의 프롬프트를 만들 수 있을 것이라 확신했다.

처음에는 우리가 필요한 기능을 구현하기 위해 Product design document를 작성하면서 요구사항과 필요한 기능들을 정리하고, 우선순위를 정했다. 모든 프로젝트의 기획 단계가 그렇듯, 브레인 스토밍을 하다보니 필요한 기능이 정말 많아졌다. 빠르게 구현하기로 했던 프로젝트의 덩치가 커지면서, 레퍼런스 겸으로 찾던 오픈소스 솔루션들을 오히려 본진으로 삼아 활용하는 것이 더 효율적이라 판단하게 되었다. 이에 따라 다양한 도구를 검토하기 시작했다.

### 초기 해결 방안 검토

프롬프트 관리 문제를 해결하기 위해 처음에는 다음과 같은 방안들을 검토했다:

1. **Git 기반 버전 관리**
   - 장점: 익숙한 도구, 변경 이력 추적 용이
   - 단점: 
     - 비개발자의 진입 장벽
     - 프롬프트 결과 비교가 어려움
     - 협업 기능 부족
   - 기각 이유: 프롬프트 특성에 맞는 전문적인 도구 필요

2. **구글 스프레드시트 활용**
   - 장점: 
     - 실시간 협업 가능
     - 사용이 쉽고 친숙함
   - 단점:
     - 버전 관리 기능 미흡
     - 대규모 데이터 처리 시 성능 저하
   - 기각 이유: 확장성과 체계적인 관리 한계

3. **자체 개발 솔루션**
   - 장점:
     - 커스텀 요구사항 완벽 대응
     - 내부 시스템과 통합 용이
   - 단점:
     - 개발 리소스 많이 필요
     - 유지보수 부담
   - 기각 이유: 시간과 리소스 제약

### 프롬프트 엔지니어링 도구 비교

우리 팀은 다양한 오픈소스 프롬프트 엔지니어링 도구들을 비교 분석했다. 각 도구마다 장단점이 있었고, 우리에게 가장 적합한 도구를 찾기 위해 주요 기능들을 중심으로 비교했다.

<style>
@media screen and (max-width: 767px) {
  .mobile-friendly-table {
    width: 100%;
  }
  .mobile-friendly-table tr {
    display: block;
    margin-bottom: 1em;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 0.5em;
    background-color: #f9f9f9;
  }
  .mobile-friendly-table td, .mobile-friendly-table th {
    display: block;
    text-align: left;
    border: none;
  }
  .mobile-friendly-table td:before {
    content: attr(data-label);
    font-weight: bold;
    display: inline-block;
    width: 100%;
  }
  .mobile-friendly-table thead {
    display: none;
  }
}
</style>

<table class="mobile-friendly-table">
  <thead>
    <tr>
      <th>기능</th>
      <th>우선순위</th>
      <th>Bench</th>
      <th>ChainForge</th>
      <th>promptfoo</th>
      <th>Agenta</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td data-label="기능">GUI 인터페이스</td>
      <td data-label="우선순위">0</td>
      <td data-label="Bench">결과만</td>
      <td data-label="ChainForge">O</td>
      <td data-label="promptfoo">제한적</td>
      <td data-label="Agenta">O</td>
    </tr>
    <tr>
      <td data-label="기능">공유 기능</td>
      <td data-label="우선순위">0</td>
      <td data-label="Bench">X</td>
      <td data-label="ChainForge">URL/파일</td>
      <td data-label="promptfoo">URL/파일</td>
      <td data-label="Agenta">X</td>
    </tr>
    <tr>
      <td data-label="기능">CSV 임포트</td>
      <td data-label="우선순위">0</td>
      <td data-label="Bench">O</td>
      <td data-label="ChainForge">O</td>
      <td data-label="promptfoo">O</td>
      <td data-label="Agenta">O</td>
    </tr>
    <tr>
      <td data-label="기능">유사도 점수</td>
      <td data-label="우선순위">0</td>
      <td data-label="Bench">O</td>
      <td data-label="ChainForge">X</td>
      <td data-label="promptfoo">O</td>
      <td data-label="Agenta">O</td>
    </tr>
    <tr>
      <td data-label="기능">규칙 기반 평가</td>
      <td data-label="우선순위">0</td>
      <td data-label="Bench">X</td>
      <td data-label="ChainForge">O</td>
      <td data-label="promptfoo">O</td>
      <td data-label="Agenta">X</td>
    </tr>
    <tr>
      <td data-label="기능">사람 평가</td>
      <td data-label="우선순위">0</td>
      <td data-label="Bench">X</td>
      <td data-label="ChainForge">X</td>
      <td data-label="promptfoo">X</td>
      <td data-label="Agenta">O</td>
    </tr>
    <tr>
      <td data-label="기능">커스텀 평가</td>
      <td data-label="우선순위">1</td>
      <td data-label="Bench">O</td>
      <td data-label="ChainForge">O</td>
      <td data-label="promptfoo">O</td>
      <td data-label="Agenta">X</td>
    </tr>
    <tr>
      <td data-label="기능">LLM 평가</td>
      <td data-label="우선순위">1</td>
      <td data-label="Bench">X</td>
      <td data-label="ChainForge">O</td>
      <td data-label="promptfoo">X</td>
      <td data-label="Agenta">O</td>
    </tr>
    <tr>
      <td data-label="기능">데이터셋 저장</td>
      <td data-label="우선순위">1</td>
      <td data-label="Bench">-</td>
      <td data-label="ChainForge">X</td>
      <td data-label="promptfoo">X</td>
      <td data-label="Agenta">O</td>
    </tr>
  </tbody>
</table>

*O: 지원, X: 미지원, -: 확인 불가*

비교 분석 결과, Agenta AI가 GUI 인터페이스, 데이터셋 저장, 사람 평가, LLM 평가 등 우리가 중요하게 생각하는 기능들을 대부분 지원하고 있었다. 특히 사람 평가 기능은 다른 도구들에서는 지원하지 않았지만, 우리 프로젝트에서는 중요한 요소였다. 반면에 Agenta AI는 커스텀 평가 기능이나 규칙 기반 평가에서는 약점을 보였다. 이런 부분을 보완하기 위해 우리가 직접 기여하면 좋겠다는 생각을 하게 되었다.

## Agenta AI와의 만남과 협업 과정

[Agenta AI](https://agenta.ai/)는 AI 애플리케이션을 개발하고 배포하는 데 필요한 프롬프트 엔지니어링, 버전 관리, 평가, 배포 기능을 통합한 플랫폼이다. 오픈소스 프로젝트로 진행되고 있어, 누구나 코드에 기여할 수 있는 특징이 있다.

처음에는 이 프로젝트의 코드와 기능을 분석하면서 우리의 요구사항과 맞는지 확인하는 과정을 거쳤다. 그 과정에서 필요한 기능이지만 아직 구현되지 않은 부분을 발견했고, 이를 직접 구현해 기여하기로 결정했다.

### Agenta AI 팀과의 미팅 일정

![Agenta AI 팀과의 화상 미팅 일정: 2023년 9월부터 11월까지 진행된 협업 일정](/assets/img/posts/agenta-meeting-calendar.jpg)

Agenta AI 팀은 우리 제안에 큰 관심을 보였다. Agenta AI 팀은 우리 아이디어를 프로젝트에 통합하는 방안을 함께 논의하자고 먼저 제안해왔다. 이후 두 달 동안 총 3번의 화상 회의를 통해 개발 방향과 기술적 세부사항을 논의했다. 이 과정에서 내가 영어로 소통할 수 있어 자연스럽게 우리 팀 코디네이터를 맡게 됐다. LLM에 대해 잘 모르면서 팀을 대표한다는 게 처음엔 부담스러웠다. 하지만 오히려 그 부담감이 더 책임감 있게 프로젝트에 임하는 계기가 됐고, 다양한 국적의 개발자들과 소통하는 경험은 값진 기억으로 남았다.

미팅을 통해 Agenta 팀의 비전과 향후 계획을 들을 수 있었고, 우리가 기여할 수 있는 부분에 대해 구체적으로 논의했다. 특히 변형 파라미터 검색 기능은 많은 사용자들이 요청했지만 아직 구현되지 않은 기능으로, 우리가 기여할 수 있는 좋은 기회였다.

## API 엔드포인트 개발 및 Pull Request

새로운 API 엔드포인트를 개발하는 과정에서 FastAPI 프레임워크를 활용해 검색 기능을 구현했다. 이 과정에서 프로젝트의 코드 패턴과 데이터 모델을 깊이 이해하게 되었고, 프로젝트의 방향성에 맞추어 개발을 진행했다. 아무런 컨텍스트 없이 아예 새로운 프로젝트의 코드 베이스를 이해하는게 생각보다 어렵긴 했지만, 코드 구조를 파악하고 기존 패턴에 맞게 새 기능을 구현해냈을 때는 정말 뿌듯했다. 특히 다른 개발자들이 작성한 코드를 분석하고 그 패턴을 따라 구현하는 과정에서 많은 것을 배울 수 있었다.

```python
@router.get("/apps/{app_name}/variants/{variant_name}", response_model=VariantConfig)
async def get_variant_by_name(app_name: str, variant_name: str):
    """
    특정 앱의 특정 variant 설정을 이름으로 조회합니다.
    """
    variant = await db.variants.find_one({"app_name": app_name, "name": variant_name})
    if not variant:
        raise HTTPException(status_code=404, detail="Variant not found")
    return variant
```
*FastAPI를 활용한 Variant 검색 API 엔드포인트 구현 코드 예시*

또한 프롬프트 저장, 식별, 버전 관리 기능 강화와 변경 이력 추적 및 롤백 기능도 제안했다. 그리고 다양한 평가 방법(one-hot 인코딩 방식의 카테고리 평가, 여러 평가자의 투표 기반 평가, 텍스트 유사도 측정)을 도입하고 평가 결과를 저장하고 공유하는 방법에 대해서도 논의했다. 특히 한국어 지원도 필요했기 때문에, custom logic을 추가하여 한국어 프롬프트를 위해 python/js 형태로 평가 로직을 지원하는 기능도 추가할 계획까지 세웠다.

협업은 순조롭게 진행되는 듯했으나, 우리의 EKS 개발 환경에 배포하는 과정에서 기술적 차이점이 드러났다. Agenta AI는 도커 컨테이너를 기반으로 동작하는데, 특히 각 프롬프트 앱마다 새로운 컨테이너를 자동으로 생성하는 Docker-in-Docker(DinD) 방식을 사용했다. 이 방식은 유연성이 높지만, 우리 회사의 Amazon EKS 환경은 보안 정책상 컨테이너에 제한된 권한만 부여하고 미리 정의된 포트만 사용할 수 있게 설정되어 있었다.

Agenta AI의 아키텍처는 컨테이너가 다른 컨테이너를 생성하고 관리하기 위해 높은 수준의 권한이 필요했고, 다양한 포트를 동적으로 사용했는데, 이는 우리 회사의 보안 정책과 맞지 않았다. 또한 Agenta AI는 컨테이너 간 통신을 위해 컨테이너 이름이나 IP를 직접 참조했지만, 쿠버네티스에서는 서비스 이름을 통한 DNS 기반 통신이 표준이었다. 이러한 아키텍처 차이를 해결하려면 Agenta AI의 핵심 구조를 상당 부분 수정해야 했고, 이는 단순한 설정 변경으로는 해결하기 어려운 수준이었다.

이런 기술적 차이점을 Agenta AI 팀과 공유했을 때, Agenta AI 팀은 우리의 상황을 이해했지만 오픈소스 프로젝트의 방향성과 우리 회사의 특수한 환경 요구사항 사이에 간극이 있었다. Agenta AI 측에서는 오히려 우리를 기여자보다는 기업 고객으로서 지원하는 방향을 제안했다. 우리 팀은 단순히 오픈소스 기여자가 되고 싶었을 뿐인데, 기업 고객이 되려면 팀 외부의 자산팀이나 다른 부서와 추가 논의가 필요했고 계약서 작성 등의 행정적 절차도 필요해 부담스러웠다. 마침 회사 내에서도 다른 프로젝트의 우선순위가 높아지고 겸직하는 업무도 조금 부담이 되어 결국 LLM 프로젝트 TF는 자연스럽게 마무리 단계로 접어들었다.

그래도 짧은 기간이었지만, 서로 다른 국가의 개발자들과 함께 코드 리뷰를 진행하며 오픈소스 협업 경험을 쌓은 것은 소중한 경험이었다. 서로 다른 배경과 경험을 가진 개발자들이 같은 목적으로 자발적으로 모여 하나의 솔루션을 개선시키려고 하는 모습이 인상적이었다. 오픈소스 기여자가 되려면 특정 언어나 도메인의 전문가 수준이어야 한다고 생각했는데, 이렇게 다른 제품에 내 이름을 한번 올리니 기분도 좋고 앞으로도 다양한 프로젝트에 적극적으로 기여자로 참여하고 싶다는 생각이 들었다.

## 오픈소스 기여의 의미

결과적으로는 프롬프트 엔지니어링 플랫폼을 완성하지는 못했지만, 이 과정을 통해 많은 것을 배울 수 있었다.

### LLM과 프롬프트 엔지니어링에 대한 이해
프롬프트 엔지니어링의 본질과 중요성을 깊이 이해하게 되었다. 단순히 텍스트를 작성하는 것이 아니라, 체계적인 접근과 반복적인 실험, 그리고 객관적인 평가가 필요한 진정한 엔지니어링 과정임을 깨달았다.

자연어의 모호성, 평가의 어려움, 비용과 시간 문제 등 여러 도전 과제가 있다는 것을 배웠다. 똑같은 의미라도 표현 방식에 따라 AI가 다르게 해석할 수 있고, 같은 프롬프트로 여러 번 질문해도 다른 답변이 나올 수 있다는 점이 흥미로웠다. 또한 "이 프롬프트가 더 좋다"를 객관적으로 증명하기 어렵고, 평가용 테스트 데이터를 만드는 것도 상당한 노력이 필요한 작업이다. 프롬프트가 길어질수록 API 호출 비용이 늘어나고, AI 응답 생성 시간이 길어지면 사용자 경험이 나빠진다는 현실적인 제약도 고려해야 했다.

LLM 기술이 발전함에 따라 프롬프트 엔지니어링의 중요성은 더욱 커질 것이다. 효과적인 프롬프트 개발을 위해서는 버전 관리, 성능 평가, 협업 기능을 갖춘 전문 도구가 필수적이며, 이는 단순한 편의성이 아닌 LLM 기반 서비스의 품질을 결정하는 핵심 요소가 될 것이다.

### 오픈소스 기여 경험
오픈소스 프로젝트에 기여하면서 협업의 중요성을 깊이 배웠다. 다양한 배경을 가진 개발자들과 함께 일하며 새로운 관점을 얻었고, 코드 리뷰 과정에서 더 나은 코드 작성법을 배울 수 있었다. 내가 겪은 문제와 해결책이 다른 사람에게도 도움이 될 수 있다는 것을 깨달았고, 모두가 함께 성장하는 오픈소스 문화의 가치를 직접 경험했다.

완벽한 솔루션보다 현실적인 문제 해결이 더 중요하며, 작은 기여라도 꾸준히 하는 것이 프로젝트 발전에 큰 도움이 된다는 사실을 배웠다. 서로 다른 국가의 개발자들과 함께 코드 리뷰를 진행하며 오픈소스 협업 경험을 쌓은 것은 소중한 경험이었다.

Agenta AI 오픈소스 프로젝트 참여는 프롬프트 엔지니어링의 체계화와 오픈소스 커뮤니티 기여라는 두 가지 가치 있는 경험을 제공했다.

### 개인적인 소감과 배움
회사에서 다른 "플랫폼"을 운영하는 사람으로서, 새로운 목적의 플랫폼을 처음부터 기획하는 경험은 매우 값진 배움이었다. 문제를 인식하고 요구사항을 도출하는 과정(버전 관리 시스템, 팀원 간 프롬프트 공유 방식, 평가 방법론 등)에서 플랫폼 설계의 핵심 원칙들을 적용해볼 수 있었다. 이런 경험을 통해 왜 프롬프트 엔지니어링이라고 부르는지, 그리고 이를 지원하는 전문 도구가 왜 필요한지 명확히 이해하게 되었다.

이번 경험은 새로운 기술 분야에 도전하는 용기의 중요성도 일깨워주었다. 처음에는 생소했던 프롬프트 엔지니어링 분야였지만, 적극적으로 배우고 기여하는 과정에서 새로운 가능성을 발견할 수 있었다. 앞으로도 이런 도전 정신을 유지하며 개발자로서 계속 성장해 나가고 싶다.

## 용어 정리
- **Container Direct Reference(컨테이너 이름이나 IP를 직접 참조)**: 컨테이너 간 통신 시 컨테이너의 이름이나 IP 주소를 직접 지정하여 연결하는 방식
- **DNS-based Communication(DNS 기반 통신)**: 컨테이너나 서비스 간 통신 시 IP 주소 대신 도메인 이름을 사용하여 유연성과 확장성을 높이는 통신 방식
- **Docker Container(도커 컨테이너)**: 애플리케이션과 그 의존성을 패키징한 독립적인 실행 환경으로, 어떤 환경에서도 일관되게 실행 가능
- **EKS Container(EKS 컨테이너)**: Amazon Elastic Kubernetes Service에서 관리되는 컨테이너로, AWS 클라우드에서 쿠버네티스를 쉽게 운영할 수 있게 해주는 환경
- **FastAPI Framework(FastAPI 프레임워크)**: 파이썬 기반의 고성능 웹 API 개발 프레임워크로, 자동 문서화와 타입 힌팅을 지원하여 빠른 개발 가능
- **Instruction(인스트럭션)**: AI 모델에게 특정 작업을 수행하도록 지시하는 명확한 명령문으로, 프롬프트의 일부로 사용됨
- **LLM(대규모 언어 모델)**: 대량의 텍스트 데이터로 학습된 인공지능 모델로, 텍스트 생성, 번역, 요약 등 다양한 자연어 처리 작업 수행 가능
- **Natural Language(자연어)**: 인간이 일상적으로 사용하는 언어로, 컴퓨터 언어와 달리 모호성과 문맥 의존성을 가짐
- **One-hot Encoding Categorical Evaluation(원-핫 인코딩 방식의 카테고리 평가)**: 카테고리형 데이터를 이진 벡터로 변환하여 각 카테고리를 독립적으로 평가하는 방식
- **Open Source(오픈소스)**: 소스 코드가 공개되어 누구나 자유롭게 사용, 수정, 배포할 수 있는 소프트웨어 개발 방식
- **Prompt(프롬프트)**: AI 모델에 입력되는 텍스트로, 모델이 특정 방식으로 응답하도록 유도하는 역할
- **Prompt Engineering(프롬프트 엔지니어링)**: AI 모델이 원하는 결과를 생성하도록 효과적인 프롬프트를 설계하고 최적화하는 과정